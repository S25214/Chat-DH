<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Face Data</title>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<style>
  body { margin: 0; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #000; color: #0f0; font-family: monospace; font-size: 3rem; }
  .lbl { font-size: 1rem; color: #555; margin-bottom: 20px; }
</style>
</head>
<body>

<div id="fc">0</div>
<div class="lbl">FACES</div>

<div id="xy">0.500, 0.500</div>
<div class="lbl">COORD (X, Y)</div>

<video id="v" style="display:none" playsinline></video>

<script>
const $ = i => document.getElementById(i);
let cx = 0.5, cy = 0.5, tx = 0.5, ty = 0.5, last = Date.now();

const fd = new FaceDetection({locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${f}`});
fd.setOptions({model: 'short', minDetectionConfidence: 0.65});

fd.onResults(res => {
  const faces = res.detections;
  const count = faces.length;
  
  if (count) {
    let wx = 0, wy = 0, tot = 0;
    for (const f of faces) {
      const b = f.boundingBox, area = b.width * b.height;
      wx += b.xCenter * area;
      wy += b.yCenter * area;
      tot += area;
    }
    tx = wx / tot; ty = wy / tot;
    last = Date.now();
  } else if (Date.now() - last > 3000) {
    tx = ty = 0.5; 
  }

  cx += (tx - cx) * 0.2;
  cy += (ty - cy) * 0.2;

  $('fc').innerText = count;
  $('xy').innerText = `${cx.toFixed(3)}, ${cy.toFixed(3)}`;
});

// Camera Setup for Mobile
const video = $('v');
const camera = new Camera(video, {
  onFrame: async () => await fd.send({image: video}),
  width: 640, height: 480,
  facingMode: 'user' // Forces Front Camera
});
camera.start();
</script>
</body>
</html>